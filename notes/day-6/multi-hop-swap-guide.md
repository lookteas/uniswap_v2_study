# Uniswap V2 å¤šè·³äº¤æ˜“ï¼ˆMulti-Hop Swapï¼‰è¯¦è§£

## é—®é¢˜åœºæ™¯

**é—®é¢˜ï¼š** å¦‚æœæˆ‘è¦ç”¨ DOGE å…‘æ¢ ETHï¼Œä½†æ˜¯æ± å­é‡Œæ²¡æœ‰ DOGE-ETH çš„äº¤æ˜“å¯¹ï¼Œåªæœ‰ DOGE-USDT å’Œ ETH-USDT çš„äº¤æ˜“å¯¹ï¼Œè¿™ä¸ªå¯ä»¥å…‘æ¢æˆåŠŸå—ï¼Ÿ

**ç­”æ¡ˆï¼š** âœ… **å¯ä»¥ï¼** Uniswap V2 æ”¯æŒå¤šè·³äº¤æ˜“ï¼ˆMulti-Hop Swapï¼‰ï¼Œå¯ä»¥é€šè¿‡ä¸­é—´ä»£å¸ï¼ˆå¦‚ USDTï¼‰æ¥å®Œæˆå…‘æ¢ã€‚

---

## æ ¸å¿ƒæ¦‚å¿µï¼šè·¯å¾„ï¼ˆPathï¼‰

åœ¨ Uniswap V2 ä¸­ï¼Œ`path` æ˜¯ä¸€ä¸ªä»£å¸åœ°å€æ•°ç»„ï¼Œå®šä¹‰äº†äº¤æ˜“çš„è·¯ç”±è·¯å¾„ï¼š

```solidity
// ç›´æ¥å…‘æ¢ï¼šDOGE -> ETHï¼ˆéœ€è¦ DOGE-ETH äº¤æ˜“å¯¹ï¼‰
path = [DOGE, ETH]

// å¤šè·³å…‘æ¢ï¼šDOGE -> USDT -> ETHï¼ˆé€šè¿‡ USDT ä¸­è½¬ï¼‰
path = [DOGE, USDT, ETH]
```

---

## çœŸå®æ‰§è¡Œæµç¨‹

### åœºæ™¯è®¾å®š
- ç”¨æˆ·æƒ³ç”¨ **1000 DOGE** å…‘æ¢ **ETH**
- å­˜åœ¨äº¤æ˜“å¯¹ï¼š**DOGE-USDT** å’Œ **ETH-USDT**
- ä¸å­˜åœ¨äº¤æ˜“å¯¹ï¼š**DOGE-ETH**

### æ‰§è¡Œè·¯å¾„
```
DOGE â†’ USDT â†’ ETH
```

### è¯¦ç»†æ­¥éª¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·è°ƒç”¨ Router åˆçº¦                               â”‚
â”‚         swapExactTokensForTokens(1000 DOGE, path=[DOGE,USDT,ETH])           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: è®¡ç®—æ‰€æœ‰ä¸­é—´é‡‘é¢ (getAmountsOut)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  amounts[0] = 1000 DOGE (è¾“å…¥)                                              â”‚
â”‚  amounts[1] = ? USDT   (é€šè¿‡ DOGE-USDT æ± è®¡ç®—)                              â”‚
â”‚  amounts[2] = ? ETH    (é€šè¿‡ ETH-USDT æ± è®¡ç®—)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: è½¬ç§» DOGE åˆ°ç¬¬ä¸€ä¸ªäº¤æ˜“å¯¹                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ç”¨æˆ·é’±åŒ… â”€â”€[1000 DOGE]â”€â”€> DOGE-USDT Pair åˆçº¦                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: ç¬¬ä¸€è·³ - DOGE â†’ USDT                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  DOGE-USDT Pair.swap()                                                      â”‚
â”‚  â€¢ è¾“å…¥: 1000 DOGE                                                          â”‚
â”‚  â€¢ è¾“å‡º: amounts[1] USDT                                                    â”‚
â”‚  â€¢ æ¥æ”¶æ–¹: ETH-USDT Pair åˆçº¦ (ä¸‹ä¸€ä¸ªæ± å­ï¼)                                 â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸ å…³é”®ä¼˜åŒ–ï¼šUSDT ç›´æ¥å‘é€åˆ°ä¸‹ä¸€ä¸ªæ± å­ï¼Œä¸ç»è¿‡ç”¨æˆ·é’±åŒ…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: ç¬¬äºŒè·³ - USDT â†’ ETH                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  ETH-USDT Pair.swap()                                                       â”‚
â”‚  â€¢ è¾“å…¥: amounts[1] USDT                                                    â”‚
â”‚  â€¢ è¾“å‡º: amounts[2] ETH                                                     â”‚
â”‚  â€¢ æ¥æ”¶æ–¹: ç”¨æˆ·é’±åŒ… (æœ€ç»ˆç›®çš„åœ°)                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… äº¤æ˜“å®Œæˆï¼ç”¨æˆ·æ”¶åˆ° ETH                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”‘ è·¯å¾„ï¼ˆPathï¼‰æ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„ï¼Ÿ

### æ ¸å¿ƒé—®é¢˜

> æ± å­é‡Œçš„ä»£å¸å¯¹é‚£ä¹ˆå¤šï¼Œåˆçº¦æ€ä¹ˆçŸ¥é“è¦è·³ 2 æ¬¡ï¼Ÿpath åˆæ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼Ÿ

### ç­”æ¡ˆ

**path ä¸æ˜¯åˆçº¦è‡ªåŠ¨è®¡ç®—çš„ï¼** åˆçº¦åªè´Ÿè´£æ‰§è¡Œï¼Œè·¯å¾„çš„è®¡ç®—å®Œå…¨åœ¨**é“¾ä¸‹ï¼ˆå‰ç«¯/SDKï¼‰**å®Œæˆã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              æ¶æ„åˆ†å±‚                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  å‰ç«¯ / SDK å±‚ï¼ˆé“¾ä¸‹ï¼‰                                               â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚  â€¢ æŸ¥è¯¢æ‰€æœ‰å¯ç”¨äº¤æ˜“å¯¹                                                â”‚   â”‚
â”‚   â”‚  â€¢ æ„å»ºäº¤æ˜“å¯¹å›¾ï¼ˆGraphï¼‰                                             â”‚   â”‚
â”‚   â”‚  â€¢ ä½¿ç”¨å›¾ç®—æ³•å¯»æ‰¾æœ€ä¼˜è·¯å¾„                                            â”‚   â”‚
â”‚   â”‚  â€¢ è®¡ç®—æ¯æ¡è·¯å¾„çš„é¢„æœŸè¾“å‡º                                            â”‚   â”‚
â”‚   â”‚  â€¢ é€‰æ‹©è¾“å‡ºæœ€å¤§çš„è·¯å¾„                                                â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â”‚ path = [DOGE, USDT, ETH]               â”‚
â”‚                                    â–¼                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  æ™ºèƒ½åˆçº¦å±‚ï¼ˆé“¾ä¸Šï¼‰                                                  â”‚   â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚   â”‚  â€¢ æ¥æ”¶ path å‚æ•°                                                   â”‚   â”‚
â”‚   â”‚  â€¢ éªŒè¯è·¯å¾„æœ‰æ•ˆæ€§ï¼ˆäº¤æ˜“å¯¹å¿…é¡»å­˜åœ¨ï¼‰                                   â”‚   â”‚
â”‚   â”‚  â€¢ æŒ‰ path é¡ºåºæ‰§è¡Œæ¯ä¸€è·³                                           â”‚   â”‚
â”‚   â”‚  â€¢ ä¸åšä»»ä½•è·¯å¾„ä¼˜åŒ–                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å‰ç«¯å¦‚ä½•è·å–é“¾ä¸Šäº¤æ˜“å¯¹ä¿¡æ¯ï¼Ÿ

å‰ç«¯/SDK é€šè¿‡**è¯»å–é“¾ä¸Šæ•°æ®**æ¥è·å–äº¤æ˜“å¯¹ä¿¡æ¯ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

#### æ–¹å¼ 1: ä» Factory åˆçº¦æŸ¥è¯¢

Factory åˆçº¦å­˜å‚¨äº†æ‰€æœ‰äº¤æ˜“å¯¹çš„ä¿¡æ¯ï¼š

```solidity
// UniswapV2Factory.sol å…³é”®æ•°æ®ç»“æ„

// é€šè¿‡ä¸¤ä¸ªä»£å¸åœ°å€æŸ¥è¯¢äº¤æ˜“å¯¹åœ°å€
mapping(address => mapping(address => address)) public getPair;

// å­˜å‚¨æ‰€æœ‰äº¤æ˜“å¯¹åœ°å€çš„æ•°ç»„
address[] public allPairs;

// è·å–äº¤æ˜“å¯¹æ€»æ•°
function allPairsLength() external view returns (uint);
```

**æŸ¥è¯¢ç¤ºä¾‹ï¼š**

```javascript
// 1. æŸ¥è¯¢ç‰¹å®šä»£å¸å¯¹æ˜¯å¦å­˜åœ¨
const pairAddress = await factory.getPair(DOGE_ADDRESS, USDT_ADDRESS);
if (pairAddress !== '0x0000000000000000000000000000000000000000') {
    console.log('DOGE-USDT äº¤æ˜“å¯¹å­˜åœ¨:', pairAddress);
}

// 2. éå†æ‰€æœ‰äº¤æ˜“å¯¹
const totalPairs = await factory.allPairsLength();
for (let i = 0; i < totalPairs; i++) {
    const pairAddress = await factory.allPairs(i);
    const pair = new ethers.Contract(pairAddress, PAIR_ABI, provider);
    const token0 = await pair.token0();
    const token1 = await pair.token1();
    console.log(`Pair ${i}: ${token0} - ${token1}`);
}
```

#### æ–¹å¼ 2: ç›‘å¬ PairCreated äº‹ä»¶

Factory åˆçº¦åœ¨åˆ›å»ºæ–°äº¤æ˜“å¯¹æ—¶ä¼šè§¦å‘äº‹ä»¶ï¼š

```solidity
event PairCreated(address indexed token0, address indexed token1, address pair, uint);
```

**å‰ç«¯ç›‘å¬ï¼š**

```javascript
// ç›‘å¬æ–°äº¤æ˜“å¯¹åˆ›å»º
factory.on('PairCreated', (token0, token1, pairAddress, pairIndex) => {
    console.log(`æ–°äº¤æ˜“å¯¹åˆ›å»º: ${token0}-${token1} at ${pairAddress}`);
    // æ›´æ–°æœ¬åœ°äº¤æ˜“å¯¹ç¼“å­˜
    updatePairCache(token0, token1, pairAddress);
});

// æŸ¥è¯¢å†å²äº‹ä»¶è·å–æ‰€æœ‰äº¤æ˜“å¯¹
const filter = factory.filters.PairCreated();
const events = await factory.queryFilter(filter, 0, 'latest');
events.forEach(event => {
    const { token0, token1, pair } = event.args;
    // æ„å»ºäº¤æ˜“å¯¹å›¾
});
```

#### æ–¹å¼ 3: ä½¿ç”¨ The Graph å­å›¾ï¼ˆæ¨èï¼‰

Uniswap å®˜æ–¹éƒ¨ç½²äº† **The Graph å­å›¾**ï¼Œç´¢å¼•äº†æ‰€æœ‰é“¾ä¸Šæ•°æ®ï¼š

```graphql
# GraphQL æŸ¥è¯¢æ‰€æœ‰äº¤æ˜“å¯¹
{
  pairs(first: 1000, orderBy: reserveUSD, orderDirection: desc) {
    id
    token0 {
      id
      symbol
    }
    token1 {
      id
      symbol
    }
    reserveUSD
  }
}
```

**ä¼˜åŠ¿ï¼š**
- æ— éœ€éå†é“¾ä¸Šæ•°æ®ï¼ŒæŸ¥è¯¢é€Ÿåº¦å¿«
- å¯ä»¥æŒ‰æµåŠ¨æ€§æ’åºï¼Œä¼˜å…ˆä½¿ç”¨æ·±åº¦å¥½çš„æ± å­
- æ”¯æŒå¤æ‚æŸ¥è¯¢å’Œè¿‡æ»¤

#### æ–¹å¼ 4: ä½¿ç”¨ CREATE2 é¢„è®¡ç®—åœ°å€

ç”±äº Uniswap V2 ä½¿ç”¨ CREATE2 åˆ›å»ºäº¤æ˜“å¯¹ï¼Œåœ°å€æ˜¯**ç¡®å®šæ€§çš„**ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—ï¼š

```solidity
// UniswapV2Library.sol
function pairFor(address factory, address tokenA, address tokenB) 
    internal pure returns (address pair) 
{
    (address token0, address token1) = sortTokens(tokenA, tokenB);
    pair = address(uint(keccak256(abi.encodePacked(
        hex'ff',
        factory,
        keccak256(abi.encodePacked(token0, token1)),
        hex'25aad938d8616b6e59148d3e701e4966de4418a752233589352d7c616a256568' // init code hash
    ))));
}
```

**å‰ç«¯å¯ä»¥ç›´æ¥è®¡ç®—åœ°å€ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æœ‰ä»£ç ï¼š**

```javascript
const pairAddress = computePairAddress(DOGE, USDT);
const code = await provider.getCode(pairAddress);
const pairExists = code !== '0x';  // å¦‚æœæœ‰ä»£ç ï¼Œè¯´æ˜äº¤æ˜“å¯¹å­˜åœ¨
```

### å®é™…è·¯å¾„æœç´¢ç­–ç•¥

ç”±äºéå†æ‰€æœ‰äº¤æ˜“å¯¹æˆæœ¬å¤ªé«˜ï¼Œå®é™…ä½¿ç”¨çš„æ˜¯**å¯å‘å¼æœç´¢**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å®é™…è·¯å¾„æœç´¢ç­–ç•¥                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. ç›´æ¥è·¯å¾„æ£€æŸ¥                                                            â”‚
â”‚     æ£€æŸ¥ DOGE-ETH æ˜¯å¦å­˜åœ¨ â†’ ä¸å­˜åœ¨ï¼Œç»§ç»­                                   â”‚
â”‚                                                                             â”‚
â”‚  2. é€šè¿‡åŸºç¡€ä»£å¸ä¸­è½¬ï¼ˆåªæ£€æŸ¥å¸¸ç”¨ä»£å¸ï¼‰                                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚  åŸºç¡€ä»£å¸åˆ—è¡¨: [WETH, USDT, USDC, DAI, WBTC]                    â”‚     â”‚
â”‚     â”‚                                                                 â”‚     â”‚
â”‚     â”‚  æ£€æŸ¥è·¯å¾„:                                                      â”‚     â”‚
â”‚     â”‚  â€¢ DOGE â†’ WETH â†’ ETH  (æ£€æŸ¥ DOGE-WETH å’Œ WETH-ETH)             â”‚     â”‚
â”‚     â”‚  â€¢ DOGE â†’ USDT â†’ ETH  (æ£€æŸ¥ DOGE-USDT å’Œ USDT-ETH) âœ… å­˜åœ¨     â”‚     â”‚
â”‚     â”‚  â€¢ DOGE â†’ USDC â†’ ETH  (æ£€æŸ¥ DOGE-USDC å’Œ USDC-ETH)             â”‚     â”‚
â”‚     â”‚  â€¢ ...                                                          â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â”‚  3. æ¯”è¾ƒæ‰€æœ‰æœ‰æ•ˆè·¯å¾„çš„è¾“å‡ºï¼Œé€‰æ‹©æœ€ä¼˜                                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ä¼˜åŒ–ï¼šä¸éå†æ‰€æœ‰äº¤æ˜“å¯¹ï¼Œåªæ£€æŸ¥é€šè¿‡å¸¸ç”¨åŸºç¡€ä»£å¸çš„è·¯å¾„ï¼**

---

### è·¯å¾„å‘ç°ç®—æ³•è¯¦è§£

#### Step 1: æ„å»ºäº¤æ˜“å¯¹å›¾

å‰ç«¯é¦–å…ˆä» Factory åˆçº¦è·å–æ‰€æœ‰å·²åˆ›å»ºçš„äº¤æ˜“å¯¹ï¼Œæ„å»ºä¸€ä¸ªå›¾ç»“æ„ï¼š

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  WETH   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
          â”‚              â”‚              â”‚
     [ETH-USDT]     [ETH-USDC]     [ETH-DAI]
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  USDT   â”‚â”€â”€â”€â”‚  USDC   â”‚â”€â”€â”€â”‚   DAI   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
     [DOGE-USDT]
          â”‚
          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  DOGE   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å›¾ä¸­æ¯æ¡è¾¹ä»£è¡¨ä¸€ä¸ªå­˜åœ¨çš„äº¤æ˜“å¯¹
```

#### Step 2: å¯»æ‰¾æ‰€æœ‰å¯èƒ½è·¯å¾„

ä» DOGE åˆ° ETHï¼Œå¯èƒ½çš„è·¯å¾„æœ‰ï¼š

```
è·¯å¾„ 1: DOGE â†’ USDT â†’ ETH        (2 è·³)
è·¯å¾„ 2: DOGE â†’ USDT â†’ USDC â†’ ETH (3 è·³)
è·¯å¾„ 3: DOGE â†’ USDT â†’ DAI â†’ ETH  (3 è·³)
...
```

#### Step 3: è®¡ç®—æ¯æ¡è·¯å¾„çš„è¾“å‡º

å¯¹äºæ¯æ¡è·¯å¾„ï¼Œè°ƒç”¨ `getAmountsOut` è®¡ç®—é¢„æœŸè¾“å‡ºã€‚

##### å‚æ•°è§£é‡Š

| å‚æ•° | å«ä¹‰ | ç¤ºä¾‹ |
|------|------|------|
| **amountIn** | ç”¨æˆ·æƒ³è¦å–å‡ºçš„è¾“å…¥ä»£å¸æ•°é‡ | `1000 DOGE`ï¼ˆç”¨æˆ·æƒ³ç”¨ 1000 ä¸ª DOGE æ¢ ETHï¼‰ |
| **path** | äº¤æ˜“è·¯å¾„ï¼Œä»£å¸åœ°å€æ•°ç»„ | `[DOGE, USDT, ETH]` |
| **amounts** | è¿”å›å€¼ï¼Œæ¯ä¸€è·³çš„é‡‘é¢æ•°ç»„ | `[1000, 50, 0.02]`ï¼ˆè§ä¸‹æ–¹è¯¦è§£ï¼‰ |

##### amounts è¿”å›æ ¼å¼è¯¦è§£

`amounts` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé•¿åº¦ç­‰äº `path.length`ï¼Œè®°å½•äº†**æ¯ä¸€æ­¥çš„ä»£å¸æ•°é‡**ï¼š

```
path    = [DOGE,  USDT,  ETH ]
amounts = [1000,  50,    0.02]
           â†‘      â†‘      â†‘
           â”‚      â”‚      â””â”€â”€ æœ€ç»ˆå¾—åˆ° 0.02 ETH
           â”‚      â””â”€â”€ ä¸­é—´å¾—åˆ° 50 USDT
           â””â”€â”€ è¾“å…¥ 1000 DOGE
```

##### å…·ä½“å…‘æ¢ç¤ºä¾‹

å‡è®¾ç”¨æˆ·æƒ³ç”¨ **1000 DOGE** æ¢ **ETH**ï¼Œä¸‹é¢æ˜¯çœŸå®æ‰§è¡Œçš„æµç¨‹å›¾ï¼š

![](../../images/path-discovery-flow.svg)

##### æœ€ä¼˜è·¯å¾„é€‰æ‹©ä»£ç 

```javascript
// amountIn = ç”¨æˆ·æƒ³å–å‡ºçš„ DOGE æ•°é‡
const amountIn = ethers.utils.parseUnits("1000", 8);  // 1000 DOGE (8ä½å°æ•°)

const paths = [
    [DOGE, USDT, ETH],
    [DOGE, USDT, USDC, ETH],
    [DOGE, USDT, DAI, ETH]
];

let bestPath = null;
let bestOutput = 0;

for (const path of paths) {
    // getAmountsOut è¿”å›æ¯ä¸€è·³çš„é‡‘é¢æ•°ç»„
    // ä¾‹å¦‚: [1000 DOGE, 50 USDT, 0.02 ETH]
    const amounts = await router.getAmountsOut(amountIn, path);
    
    // å–æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´  = æœ€ç»ˆèƒ½å¾—åˆ°çš„ ETH æ•°é‡
    const output = amounts[amounts.length - 1];
    
    console.log(`è·¯å¾„ ${path.map(t => t.symbol).join(' â†’ ')}`);
    console.log(`  amounts: ${amounts.map(a => a.toString())}`);
    console.log(`  æœ€ç»ˆè¾“å‡º: ${ethers.utils.formatEther(output)} ETH`);
    
    // æ¯”è¾ƒï¼Œä¿ç•™è¾“å‡ºæœ€å¤§çš„è·¯å¾„
    if (output.gt(bestOutput)) {  // BigNumber æ¯”è¾ƒç”¨ .gt()
        bestOutput = output;
        bestPath = path;
    }
}

console.log(`\næœ€ä¼˜è·¯å¾„: ${bestPath.map(t => t.symbol).join(' â†’ ')}`);
console.log(`æœ€ä¼˜è¾“å‡º: ${ethers.utils.formatEther(bestOutput)} ETH`);

// è¾“å‡ºç¤ºä¾‹:
// è·¯å¾„ DOGE â†’ USDT â†’ ETH
//   amounts: [100000000000, 5000000000, 20000000000000000]
//   æœ€ç»ˆè¾“å‡º: 0.02 ETH
// è·¯å¾„ DOGE â†’ USDT â†’ USDC â†’ ETH
//   amounts: [100000000000, 5000000000, 4980000000, 19000000000000000]
//   æœ€ç»ˆè¾“å‡º: 0.019 ETH
// ...
// æœ€ä¼˜è·¯å¾„: DOGE â†’ USDT â†’ ETH
// æœ€ä¼˜è¾“å‡º: 0.02 ETH
```

##### ä¸ºä»€ä¹ˆè·¯å¾„ 1 è¾“å‡ºæœ€å¤šï¼Ÿ

| å› ç´  | è¯´æ˜ |
|------|------|
| **è·³æ•°å°‘** | æ¯è·³æ”¶ 0.3% æ‰‹ç»­è´¹ï¼Œ2 è·³ vs 3 è·³ |
| **æ‰‹ç»­è´¹ç´¯è®¡** | è·¯å¾„ 1: 0.997Â² â‰ˆ 99.4%<br>è·¯å¾„ 2: 0.997Â³ â‰ˆ 99.1% |
| **æ»‘ç‚¹ç´¯è®¡** | è·³æ•°è¶Šå¤šï¼Œä»·æ ¼å½±å“è¶Šå¤§ |

**ç»“è®ºï¼šé€šå¸¸è·³æ•°è¶Šå°‘è¶Šå¥½ï¼Œä½†å¦‚æœä¸­é—´æ± å­æµåŠ¨æ€§å¾ˆå·®ï¼Œå¤šè·³åè€Œå¯èƒ½æ›´ä¼˜ã€‚**

#### Step 4: é€‰æ‹©æœ€ä¼˜è·¯å¾„

è€ƒè™‘å› ç´ ï¼š
- **è¾“å‡ºé‡‘é¢**ï¼šé€‰æ‹©è¾“å‡ºæœ€å¤§çš„è·¯å¾„
- **Gas æˆæœ¬**ï¼šè·³æ•°è¶Šå¤šï¼ŒGas è¶Šé«˜
- **æ»‘ç‚¹å½±å“**ï¼šå¤§é¢äº¤æ˜“å¯èƒ½éœ€è¦æ‹†åˆ†åˆ°å¤šæ¡è·¯å¾„

### å¸¸è§ä¸­é—´ä»£å¸ï¼ˆBase Tokensï¼‰

ä¸ºäº†ç®€åŒ–è·¯å¾„æœç´¢ï¼Œé€šå¸¸åªè€ƒè™‘é€šè¿‡ä»¥ä¸‹"åŸºç¡€ä»£å¸"ä¸­è½¬ï¼š

| ä»£å¸ | è¯´æ˜ |
|------|------|
| **WETH** | æœ€å¸¸ç”¨çš„ä¸­é—´ä»£å¸ï¼ŒæµåŠ¨æ€§æœ€å¥½ |
| **USDT** | ç¨³å®šå¸ï¼Œä¸å¤§å¤šæ•°ä»£å¸æœ‰äº¤æ˜“å¯¹ |
| **USDC** | ç¨³å®šå¸ |
| **DAI** | å»ä¸­å¿ƒåŒ–ç¨³å®šå¸ |
| **WBTC** | æ¯”ç‰¹å¸é”šå®šå¸ |

### Uniswap SDK è·¯å¾„è®¡ç®—ç¤ºä¾‹

```typescript
import { Token, Pair, Route, Trade, TradeType } from '@uniswap/v2-sdk'

// å®šä¹‰ä»£å¸
const DOGE = new Token(1, '0x...', 8, 'DOGE')
const USDT = new Token(1, '0x...', 6, 'USDT')
const WETH = new Token(1, '0x...', 18, 'WETH')

// è·å–äº¤æ˜“å¯¹ï¼ˆéœ€è¦ä»é“¾ä¸ŠæŸ¥è¯¢å‚¨å¤‡é‡ï¼‰
const pair_DOGE_USDT = new Pair(/* ... */)
const pair_USDT_WETH = new Pair(/* ... */)

// æ„å»ºè·¯ç”±ï¼ˆSDK è‡ªåŠ¨å¤„ç†è·¯å¾„ï¼‰
const route = new Route(
    [pair_DOGE_USDT, pair_USDT_WETH],  // äº¤æ˜“å¯¹åºåˆ—
    DOGE,                               // è¾“å…¥ä»£å¸
    WETH                                // è¾“å‡ºä»£å¸
)

// route.path = [DOGE, USDT, WETH]  â† è¿™å°±æ˜¯ä¼ ç»™åˆçº¦çš„ pathï¼

// åˆ›å»ºäº¤æ˜“
const trade = new Trade(
    route,
    CurrencyAmount.fromRawAmount(DOGE, '1000000000'),
    TradeType.EXACT_INPUT
)

// è·å–è°ƒç”¨å‚æ•°
const { methodName, args } = Router.swapCallParameters(trade, {
    slippageTolerance: new Percent('50', '10000'),  // 0.5% æ»‘ç‚¹
    deadline: Math.floor(Date.now() / 1000) + 60 * 20
})

// args åŒ…å«: [amountIn, amountOutMin, path, to, deadline]
```

### ä¸ºä»€ä¹ˆåˆçº¦ä¸è‡ªåŠ¨è®¡ç®—è·¯å¾„ï¼Ÿ

| åŸå›  | è¯´æ˜ |
|------|------|
| **Gas æˆæœ¬** | é“¾ä¸Šå›¾æœç´¢ç®—æ³•æ¶ˆè€—å¤§é‡ Gas |
| **å¤æ‚åº¦** | éœ€è¦éå†æ‰€æœ‰äº¤æ˜“å¯¹ï¼Œè®¡ç®—é‡å·¨å¤§ |
| **çµæ´»æ€§** | ç”¨æˆ·/èšåˆå™¨å¯ä»¥è‡ªå®šä¹‰è·¯ç”±ç­–ç•¥ |
| **ç¡®å®šæ€§** | é“¾ä¸Šè®¡ç®—å¯èƒ½å› åŒºå—ä¸åŒå¯¼è‡´è·¯å¾„å˜åŒ– |

### è·¯å¾„éªŒè¯

åˆçº¦è™½ç„¶ä¸è®¡ç®—è·¯å¾„ï¼Œä½†ä¼š**éªŒè¯è·¯å¾„æœ‰æ•ˆæ€§**ï¼š

```solidity
// UniswapV2Library.sol
function getAmountsOut(...) {
    require(path.length >= 2, 'UniswapV2Library: INVALID_PATH');
    
    for (uint i; i < path.length - 1; i++) {
        // è·å–å‚¨å¤‡é‡æ—¶ä¼šæ£€æŸ¥äº¤æ˜“å¯¹æ˜¯å¦å­˜åœ¨
        (uint reserveIn, uint reserveOut) = getReserves(factory, path[i], path[i + 1]);
        // å¦‚æœäº¤æ˜“å¯¹ä¸å­˜åœ¨ï¼ŒgetReserves ä¼š revert
    }
}
```

å¦‚æœä¼ å…¥çš„ path ä¸­ä»»æ„ç›¸é‚»ä¸¤ä¸ªä»£å¸æ²¡æœ‰äº¤æ˜“å¯¹ï¼Œäº¤æ˜“ä¼šå¤±è´¥ã€‚

---

## æ ¸å¿ƒä»£ç è§£æ

### 1. Router åˆçº¦ - swapExactTokensForTokens

```solidity
// æ–‡ä»¶: UniswapV2Router02.sol

function swapExactTokensForTokens(
    uint amountIn,           // è¾“å…¥é‡‘é¢ (1000 DOGE)
    uint amountOutMin,       // æœ€å°è¾“å‡ºé‡‘é¢ (æ»‘ç‚¹ä¿æŠ¤)
    address[] calldata path, // è·¯å¾„ [DOGE, USDT, ETH]
    address to,              // æ¥æ”¶åœ°å€
    uint deadline            // æˆªæ­¢æ—¶é—´
) external returns (uint[] memory amounts) {
    // 1. è®¡ç®—æ¯ä¸€è·³çš„è¾“å‡ºé‡‘é¢
    amounts = UniswapV2Library.getAmountsOut(factory, amountIn, path);
    
    // 2. æ£€æŸ¥æœ€ç»ˆè¾“å‡ºæ˜¯å¦æ»¡è¶³æœ€å°è¦æ±‚
    require(amounts[amounts.length - 1] >= amountOutMin, 
            'UniswapV2Router: INSUFFICIENT_OUTPUT_AMOUNT');
    
    // 3. å°†è¾“å…¥ä»£å¸è½¬åˆ°ç¬¬ä¸€ä¸ªäº¤æ˜“å¯¹
    TransferHelper.safeTransferFrom(
        path[0],                                              // DOGE
        msg.sender,                                           // ç”¨æˆ·
        UniswapV2Library.pairFor(factory, path[0], path[1]), // DOGE-USDT Pair
        amounts[0]                                            // 1000 DOGE
    );
    
    // 4. æ‰§è¡Œé“¾å¼äº¤æ¢
    _swap(amounts, path, to);
}
```

### 2. é“¾å¼äº¤æ¢æ ¸å¿ƒé€»è¾‘ - _swap

```solidity
function _swap(uint[] memory amounts, address[] memory path, address _to) internal {
    for (uint i; i < path.length - 1; i++) {
        (address input, address output) = (path[i], path[i + 1]);
        (address token0,) = UniswapV2Library.sortTokens(input, output);
        uint amountOut = amounts[i + 1];
        
        // ç¡®å®šè¾“å‡ºæ–¹å‘
        (uint amount0Out, uint amount1Out) = input == token0 
            ? (uint(0), amountOut) 
            : (amountOut, uint(0));
        
        // ğŸ”‘ å…³é”®ï¼šç¡®å®šæ¥æ”¶åœ°å€
        // å¦‚æœä¸æ˜¯æœ€åä¸€è·³ï¼Œæ¥æ”¶åœ°å€æ˜¯ä¸‹ä¸€ä¸ªäº¤æ˜“å¯¹
        // å¦‚æœæ˜¯æœ€åä¸€è·³ï¼Œæ¥æ”¶åœ°å€æ˜¯ç”¨æˆ·
        address to = i < path.length - 2 
            ? UniswapV2Library.pairFor(factory, output, path[i + 2])  // ä¸‹ä¸€ä¸ªæ± å­
            : _to;  // ç”¨æˆ·åœ°å€
        
        // æ‰§è¡Œäº¤æ¢
        IUniswapV2Pair(UniswapV2Library.pairFor(factory, input, output))
            .swap(amount0Out, amount1Out, to, new bytes(0));
    }
}
```

### 3. é‡‘é¢è®¡ç®— - getAmountsOut

```solidity
// æ–‡ä»¶: UniswapV2Library.sol

// é“¾å¼è®¡ç®—æ¯ä¸€è·³çš„è¾“å‡ºé‡‘é¢
function getAmountsOut(
    address factory, 
    uint amountIn, 
    address[] memory path
) internal view returns (uint[] memory amounts) {
    require(path.length >= 2, 'UniswapV2Library: INVALID_PATH');
    amounts = new uint[](path.length);
    amounts[0] = amountIn;  // åˆå§‹è¾“å…¥
    
    // éå†æ¯ä¸€è·³
    for (uint i; i < path.length - 1; i++) {
        // è·å–å½“å‰äº¤æ˜“å¯¹çš„å‚¨å¤‡é‡
        (uint reserveIn, uint reserveOut) = getReserves(factory, path[i], path[i + 1]);
        // è®¡ç®—è¾“å‡ºé‡‘é¢ï¼ˆæ‰£é™¤ 0.3% æ‰‹ç»­è´¹ï¼‰
        amounts[i + 1] = getAmountOut(amounts[i], reserveIn, reserveOut);
    }
}

// å•è·³é‡‘é¢è®¡ç®—ï¼ˆå« 0.3% æ‰‹ç»­è´¹ï¼‰
function getAmountOut(
    uint amountIn, 
    uint reserveIn, 
    uint reserveOut
) internal pure returns (uint amountOut) {
    uint amountInWithFee = amountIn * 997;  // æ‰£é™¤ 0.3% æ‰‹ç»­è´¹
    uint numerator = amountInWithFee * reserveOut;
    uint denominator = reserveIn * 1000 + amountInWithFee;
    amountOut = numerator / denominator;
}
```

---

## æ‰‹ç»­è´¹è®¡ç®—

æ¯ä¸€è·³éƒ½ä¼šæ”¶å– **0.3%** çš„æ‰‹ç»­è´¹ï¼š

| è·³æ•° | ç´¯è®¡æ‰‹ç»­è´¹ | å‰©ä½™æ¯”ä¾‹ |
|------|-----------|---------|
| 1è·³  | 0.3%      | 99.7%   |
| 2è·³  | ~0.6%     | 99.4%   |
| 3è·³  | ~0.9%     | 99.1%   |

**ç¤ºä¾‹è®¡ç®—ï¼ˆDOGE â†’ USDT â†’ ETHï¼‰ï¼š**
- è¾“å…¥: 1000 DOGE
- ç¬¬ä¸€è·³å: 1000 Ã— 0.997 = 997 DOGE ç­‰å€¼çš„ USDT
- ç¬¬äºŒè·³å: USDTæ•°é‡ Ã— 0.997 = æœ€ç»ˆ ETH

---

## Gas ä¼˜åŒ–è®¾è®¡

Uniswap V2 çš„å¤šè·³äº¤æ˜“æœ‰ä¸€ä¸ªå…³é”®ä¼˜åŒ–ï¼š

```
âŒ ä½æ•ˆæ–¹å¼ï¼šDOGE â†’ ç”¨æˆ·é’±åŒ… â†’ USDT â†’ ç”¨æˆ·é’±åŒ… â†’ ETH
âœ… é«˜æ•ˆæ–¹å¼ï¼šDOGE â†’ DOGE-USDTæ±  â†’ ETH-USDTæ±  â†’ ç”¨æˆ·é’±åŒ…
```

ä¸­é—´ä»£å¸**ç›´æ¥ä»ä¸€ä¸ªæ± å­è½¬åˆ°ä¸‹ä¸€ä¸ªæ± å­**ï¼Œä¸ç»è¿‡ç”¨æˆ·é’±åŒ…ï¼ŒèŠ‚çœäº† Gasã€‚

---

## å‰ç«¯è°ƒç”¨ç¤ºä¾‹

```javascript
// ä½¿ç”¨ ethers.js è°ƒç”¨å¤šè·³äº¤æ˜“
const router = new ethers.Contract(ROUTER_ADDRESS, ROUTER_ABI, signer);

const path = [
    DOGE_ADDRESS,   // è¾“å…¥ä»£å¸
    USDT_ADDRESS,   // ä¸­é—´ä»£å¸
    WETH_ADDRESS    // è¾“å‡ºä»£å¸ (ETH ç”¨ WETH è¡¨ç¤º)
];

const amountIn = ethers.utils.parseUnits("1000", 8);  // 1000 DOGE
const amountOutMin = 0;  // ç”Ÿäº§ç¯å¢ƒåº”è®¾ç½®æ»‘ç‚¹ä¿æŠ¤
const deadline = Math.floor(Date.now() / 1000) + 60 * 20;  // 20åˆ†é’Ÿ

// å…ˆæˆæƒ
await dogeToken.approve(ROUTER_ADDRESS, amountIn);

// æ‰§è¡Œäº¤æ¢
const tx = await router.swapExactTokensForTokens(
    amountIn,
    amountOutMin,
    path,
    userAddress,
    deadline
);
```

---

## æ€»ç»“

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ˜¯å¦æ”¯æŒ** | âœ… å®Œå…¨æ”¯æŒå¤šè·³äº¤æ˜“ |
| **è·¯å¾„é•¿åº¦** | ç†è®ºä¸Šæ— é™åˆ¶ï¼Œå®é™…å— Gas é™åˆ¶ |
| **æ‰‹ç»­è´¹** | æ¯è·³ 0.3%ï¼Œç´¯è®¡è®¡ç®— |
| **Gas ä¼˜åŒ–** | ä¸­é—´ä»£å¸ç›´æ¥æ± å¯¹æ± è½¬ç§» |
| **æ»‘ç‚¹é£é™©** | è·³æ•°è¶Šå¤šï¼Œæ»‘ç‚¹é£é™©è¶Šå¤§ |

**æ ¸å¿ƒåŸç†ï¼š** Router åˆçº¦é€šè¿‡ `path` å‚æ•°å®šä¹‰äº¤æ˜“è·¯å¾„ï¼Œ`_swap` å‡½æ•°å¾ªç¯æ‰§è¡Œæ¯ä¸€è·³ï¼Œå°†ä¸­é—´ä»£å¸ç›´æ¥å‘é€åˆ°ä¸‹ä¸€ä¸ªæ± å­ï¼Œæœ€åä¸€è·³æ‰å‘é€åˆ°ç”¨æˆ·åœ°å€ã€‚
